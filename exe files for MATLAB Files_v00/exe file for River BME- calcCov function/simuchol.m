function [Zh,L]=simuchol(ch,covmodel,covparam,ns,dist);% simuchol                  - simulation by the Cholesky method (Jan 1,2001)%% Implementation of the traditional non conditional% simulation method based on a Choleski decomposition% of the covariance matrix. This simulation method is% especially recommended for simulating independantly% several sets of a limited number of hard values% (less than few hundreds). Simulated values are zero% mean Gaussian distributed. %% SYNTAX :%% [Zh,L]=simuchol(ch,covmodel,covparam,ns,dist);%% INPUT :%% ch         nh by d   matrix of coordinates for the locations%                      where hard data have to be simulated. A%                      line corresponds to the vector of coordinates%                      at a simulation location, so the number of%                      columns corresponds to the dimension of the%                      space. There is no restriction on the dimension%                      of the space.% covmodel   string    string that contains the name of the covariance%                      model which is used for the simulation (see the%                      MODELS directory). Variogram models are not%                      available for this function.% covparam   1 by k    vector of values for the parameters of covmodel,%                      according to the convention for the corresponding%                      covariance model.% ns         scalar    number of sets of simulated values which are required.%                      If the optional ns variable is omitted from the input%                      list of variables, simuchol.m produces a single set%                      of simulated values.%% dist   cell          optional parameter giving the function to calculate distances.%                      dist{1} is the name of the distance function, such that the%                      distances between the points c1 and c2 is calculated using %                      [d]=eval([dist{1},'(c1,c2)']), where c1 and c2 are n1 by 2 and %                      n2 by 2 matrices, respectively, and d is a n1 by n2 matrix of %                      distances between c1 and c2.%                      dist{2} is an optional parameter. Hence when length(dist)>1, then the%                      distance matrix is calculated using [d]=eval([dist{1},'(c1,c2,dist{2})'])%                      Note: The default is dist={'coord2dist'}% % OUTPUT :%% Zh         nh by ns  matrix of zero mean simulated Gaussian distributed hard%                      values at the coordinates specified in ch. Each column%                      corresponds to a different simulation, so that if ns=1%                      or if ns is omitted, Zh is a column vector of values.%                      Each simulated vector of values is statistically%                      independant from the others.% L          nh by nh  upper triangular matrix obtained from the Choleski%                      decomposition of the global covariance matrix C for%                      values at the ch coordinates, such that C=L'*L.%% NOTE :%% All the specific conventions for specifying nested models,% multivariate or space-time cases are the same as for kriging.m.if nargin<4,  ns=1;end;if nargin<5,  dist{1}={'coord2dist'};end;[K]=coord2K(ch,ch,covmodel,covparam,1,dist);L=chol(K);Lt=L';n=size(Lt,1);Zh=zeros(n,ns);for i=1:ns,   Zh(:,i)=Lt*randn(n,1); end;